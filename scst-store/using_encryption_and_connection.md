# Configure target endpoint and certificate

The connection to the Store requires TLS encryption. Follow the instructions below to set up the TLS connection depending on which type of service is being used:

1. Using `LoadBalancer`
1. Using `NodePort` â€” commonly used with local clusters such as kind, or minikube

## <a id='use-lb'></a>Using `LoadBalancer`

If you are using a `LoadBalancer` configuration, you need to find the external IP of the `metadata-store-app` service. You can use `kubectl` to do this.

>**Note**: For all `kubectl` commands, use the `--namespace metadata-store` flag.

```
kubectl get service/metadata-store-app --namespace metadata-store -o yaml
```

For example:

```
$ kubectl get service/metadata-store-app --namespace metadata-store -o yaml
...
spec:
  ports:
  - name: http
    nodePort: 32712
    port: 8443
    protocol: TCP
    targetPort: PORT
...
status:
  loadBalancer:
    ingress:
    - ip: IP-ADDRESS
```
Where:

- `IP-ADDRESS` is your IP address.
- `PORT` is your port number.

### <a id='obtain-ca-lb'></a>Obtaining the CA certificate

The CA certificate is generated by cert manager. Run the following command to get the CA certificate:

```
kubectl get secret app-tls-cert -n metadata-store -o json | jq -r '.data."ca.crt"' | base64 -d > PATH
```

Where:

- `PATH` is the location where you want to save the CA certificate. This file is used later when you [configure the CLI](cli_configuration.md).

If using an Ingress, the CA certificate for clients should be that one of the ingress domain:

```
kubectl get secret ingress-cert -n metadata-store -o json | jq -r '.data."ca.crt"' | base64 -d > PATH
```

### <a id='dns-resolution'></a>DNS resolution

In order to support TLS domain verification, you'll need to setup a record to resolve to the IP handling the connections. This can be achieved via a DNS server or by modifying your local `/etc/hosts` file. 

If ingress is enabled, this IP should point to the `envoy`'s service external IP from the `metadata-store` subdomain record.

```
IP metadata-store.<ingress_domain>
```

For installations without ingress enabled, add the IP entry mapping to `metadata-store-app.metadata-store.svc.cluster.local`.

```
IP metadata-store-app.metadata-store.svc.cluster.local
```

Where:

- `IP` is the IP you got from the step *Using `LoadBalancer`* step above or the `envoy`'s service external IP. 

For example:

```bash
10.186.124.220 metadata-store-app.metadata-store.svc.cluster.local
# if using ingress
10.186.124.220 metadata-store.example.com
```

## <a id='use-np'></a>Using `NodePort`
To use NodePort, obtain the CA cert, configure portforwarding, and modify the `/etc/hosts` file.

### <a id='obtain-ca-np'></a>Obtaining the CA certificate

The CA certificate is generated by cert manager. Run the following command to get the CA certificate:

```
kubectl get secret app-tls-cert -n metadata-store -o json | jq -r '.data."ca.crt"' | base64 -d > PATH
```

Where:

- `PATH` is the location where you want to save the CA certificate. This file is used later when you [configure the CLI](cli_configuration.md).

If using an Ingress, the CA certificate for clients should be that one of the ingress domain:

```
kubectl get secret ingress-cert -n metadata-store -o json | jq -r '.data."ca.crt"' | base64 -d > PATH
```

### <a id='config-pf'></a>Configuring port forwarding
When using `NodePort`, you need to configure port forwarding for the service for the CLI to access the Supply Chain Security Tools - Store. Run:

```
kubectl port-forward service/metadata-store-app 8443:8443 -n metadata-store
```

Run this command in a separate terminal window.

### <a id='mod-etchost'></a>Modifying your `/etc/hosts` file

Add the following entry to `/etc/hosts` by running:

```
127.0.0.1 metadata-store-app.metadata-store.svc.cluster.local
```
